$def with (course,task,individual_data,classroom_data)

$#
$# This file is part of INGInious. See the LICENSE and the COPYRIGHTS files for
$# more information about the licensing of this file.
$#

$var title: $:task.get_name(user_manager.session_language()) - $:course.get_name(user_manager.session_language())

$var Column: $:template_helper.call('course_admin_menu',course=course,current='tasks')

$ is_admin = user_manager.has_admin_rights_on_course(course)

$def NavbarF():
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="$get_homepath()/course/$course.get_id()">$course.get_name(user_manager.session_language())</a></li>
            <li class="breadcrumb-item"><a href="$get_homepath()/admin/$course.get_id()" title=$:_('"Administration"') data-toggle="tooltip" data-placement="bottom">
                <i class="fa fa-user-secret"></i></a></li>
            <li class="breadcrumb-item"><a href="$get_homepath()/admin/$course.get_id()/tasks" title=$:_('"Tasks"') data-toggle="tooltip" data-placement="bottom">
                <i class="fa fa-tasks"></i></a></li>
            <li class="breadcrumb-item active"><a href="#">$task.get_name(user_manager.session_language()) <span class="sr-only">(current)</span></a></li>
        </ol>
    </nav>
$var Navbar: $:NavbarF()

<h2>$:_("Results for task \"{}\"").format(task.get_name(user_manager.session_language()))</h2>
                    $if not course.is_lti():
                        <div class="card">
                            <div class="card-header">
                                <ul class="nav nav-tabs card-header-tabs">
                                            <li role="presentation" class="nav-item "><a href="#tab_indiv" class="nav-link active" aria-controls="basicinfo" role="tab" data-toggle="tab"><i class="fa
                                    fa-user fa-fw"></i>&nbsp; $:_("Individual results")</a></li>
                                            <li role="presentation" class="nav-item"><a href="#tab_classroom" class="nav-link" aria-controls="container" role="tab" data-toggle="tab"><i class="fa
                                    fa-users fa-fw"></i>&nbsp; $:_("Classroom results")</a></li>
                                </ul>
                            </div>
                            <div id="edit_task_tabs_content" class="tab-content">
                                <div role="tabpanel" class="card-body tab-pane active" id="tab_indiv">


                    <table class="table">
                        <thead class="table-borderless">
                            <tr>
                                <th>$:_("Student")</th>
                                <th>$:_("Status")</th>
                                <th>$:_("# submissions")</th>
                                <th>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a href="$get_homepath()/admin/${course.get_id()}/download?format=taskid%2Fusername&tasks=$task.get_id()" class="btn btn-danger"
                                           title=$:_('"Download all submissions"') data-toggle="tooltip" data-placement="bottom"><i class="fa fa-download"></i></a>
                                        $if is_admin:
                                            <a href="$get_homepath()/admin/${course.get_id()}/replay?format=taskid%2Fusername&tasks=$task.get_id()" class="btn btn-warning"
                                               title=$:_('"Replay all submissions"') data-toggle="tooltip" data-placement="bottom"><i class="fa fa-refresh"></i></a>
                                        <a href="$get_homepath()/admin/${course.get_id()}/task/${task.get_id()}?csv=students" class="btn btn-info" title="$:_('Download CSV')"
                                           data-toggle="tooltip" data-placement="bottom"><i class="fa fa-table"></i></a>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                        $for user in individual_data:
                            <tr
                                $if user["status"] == "notattempted":
                                    class="table-warning"
                                $elif user["status"] == "succeeded":
                                    class="table-success"
                                $elif user["status"] == "failed":
                                    class="table-danger"
                            >
                                <td>
                                    $if user["realname"] != "":
                                        <a href="$get_homepath()/admin/${course.get_id()}/student/$user['username']">$user["realname"]</a>
                                        (<a href="$get_homepath()/admin/${course.get_id()}/student/$user['username']">$user["username"]</a> - <a href='mailto:$user["email"]'>email</a>)
                                    $else:
                                        <a href="$get_homepath()/admin/${course.get_id()}/student/$user['username']">$user["username"]</a>
                                </td>
                                <td>
                                    $if user["status"] == "notviewed":
                                        $:_("Not viewed")
                                    $elif user["status"] == "notattempted":
                                        $:_("Not attempted (viewed)")
                                    $elif user["status"] == "succeeded":
                                        $:_("Succeeded") ($user["grade"]%)
                                    $else:
                                        $:_("Failed") ($user["grade"]%)
                                </td>
                                <td>$user["tried"] </td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a href="$get_homepath()/admin/${course.get_id()}/submissions?user=$user['username']&task=$task.get_id()" class="btn btn-secondary"
                                           title=$:_('"View submissions"') data-toggle="tooltip" data-placement="bottom"><i class="fa fa-search"></i></a>
                                        <a href="$get_homepath()/admin/${course.get_id()}/download$user['url']" class="btn btn-secondary"
                                           title=$:_('"Download submissions"') data-toggle="tooltip" data-placement="bottom"><i class="fa fa-download"></i></a>
                                        $if is_admin:
                                            <a href="$get_homepath()/admin/${course.get_id()}/replay$user['url']" class="btn btn-secondary"
                                               title=$:_('"Replay submissions"') data-toggle="tooltip" data-placement="bottom"><i class="fa fa-refresh"></i></a>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

        $if not course.is_lti():
                    </div>
                    <div role="tabpanel" class="card-body tab-pane" id="tab_classroom">
                        <table class="table">
                            <thead class="table-borderless">
                                <tr>
                                    <th>$:_("Classroom")</th>
                                    <th>$:_("Status")</th>
                                    <th>$:_("# submissions")</th>
                                    <th>
                                        <div class="btn-group btn-group-sm" role="group">
                                            <a href="$get_homepath()/admin/${course.get_id()}/download?format=taskid%2Fclassroom&tasks=$task.get_id()" class="btn btn-danger"
                                               title=$:_('"Download all submissions"') data-toggle="tooltip" data-placement="bottom"><i class="fa fa-download"></i></a>
                                            $if is_admin:
                                                <a href="$get_homepath()/admin/${course.get_id()}/replay?format=taskid%2Fclassroom&tasks=$task.get_id()" class="btn btn-warning"
                                                   title=$:_('"Replay all submissions"') data-toggle="tooltip" data-placement="bottom"><i class="fa fa-refresh"></i></a>
                                            <a href="$get_homepath()/admin/${course.get_id()}/task/${task.get_id()}?csv=classrooms" class="btn btn-info" title=$:_('"Download CSV"')
                                               data-toggle="tooltip" data-placement="bottom"><i class="fa fa-table"></i></a>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                            $ text = [_("My classroom(s)"),_("Other classroom(s)")]
                            $for ind in range(0,2):
                                $if len(classroom_data[ind]) > 0:
                                    $if len(classroom_data[0]) > 0 and len(classroom_data[1]) > 0:
                                        <tr>
                                            <th colspan="5">$text[ind]</th>
                                        </tr>
                                $for classroom in classroom_data[ind]:
                                    <tr
                                        $if classroom["status"] == "notattempted":
                                            class="table-warning"
                                        $elif classroom["status"] == "succeeded":
                                            class="table-success"
                                        $elif classroom["status"] == "failed":
                                            class="table-danger"
                                    >
                                        <td>
                                            <a href="$get_homepath()/admin/${course.get_id()}/classroom/$classroom['_id']">$classroom['description']</a>
                                        </td>
                                        <td>
                                            $if classroom["status"] == "notviewed":
                                                $:_("Not viewed")
                                            $elif classroom["status"] == "notattempted":
                                                $:_("Not attempted (viewed)")
                                            $elif classroom["status"] == "succeeded":
                                                $:_("Succeeded") ($classroom["grade"]%)
                                            $else:
                                                $:_("Failed") ($classroom["grade"]%)
                                        </td>
                                        <td>$classroom["tried"] </td>
                                        <td>
                                            <div class="btn-group btn-group-sm" role="group">
                                                <!--<a href="$get_homepath()/admin/${course.get_id()}/classroom/$classroom['_id']/$task.get_id()" class="btn btn-outline-primary btn-xs"-->
                                                <a href="$get_homepath()/admin/${course.get_id()}/submissions?classroom=$classroom['_id']&task=$task.get_id()" class="btn btn-secondary"
                                                   title=$:_('"View submissions"') data-toggle="tooltip" data-placement="bottom"><i class="fa fa-search"></i></a>
                                                <a href="$get_homepath()/admin/${course.get_id()}/download$classroom['url']" class="btn btn-secondary"
                                                   title=$:_('"Download  submissions"') data-toggle="tooltip" data-placement="bottom"><i class="fa fa-download"></i></a>
                                                $if is_admin:
                                                    <a href="$get_homepath()/admin/${course.get_id()}/replay$classroom['url']" class="btn btn-secondary"
                                                       title=$:_('"Replay submissions"') data-toggle="tooltip" data-placement="bottom"><i class="fa fa-refresh"></i></a>
                                            </div>
                                        </td>
                                    </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
